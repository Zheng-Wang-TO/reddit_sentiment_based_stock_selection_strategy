# Reddit & S&P 500: A Stock Sentiment Analysis & Backtesting Project

## Project Overview

This repository contains a Python-based project designed to analyze stock market sentiment on Reddit and backtest a corresponding investment strategy. The project is divided into two core components:

1.  **Sentiment Scraper**: A script that scrapes financial subreddits (e.g., `r/wallstreetbets`, `r/investing`) to find the top 5 most discussed S&P 500 tickers each week from 2021 to 2023. A key feature is its use of historical S&P 500 constituent data, ensuring that a stock is only considered if it was part of the index during the week of its mention.

2.  **Strategy Backtester**: A second script that takes the output from the scraper and simulates a simple, rules-based investment strategy. It "buys" the top 5 tickers at the beginning of the week and "sells" them at the end, then rigorously evaluates the strategy's performance against market benchmarks like SPY and QQQ.

This project showcases skills in data acquisition via APIs, natural language processing (NLP), financial analysis, and Python programming for data science.

---

## Key Features

- **Dynamic Data Scraping**: Connects to the Reddit API using PRAW to fetch posts from multiple subreddits.
- **Historical Accuracy**: Filters ticker mentions against weekly S&P 500 constituent lists to avoid lookahead bias.
- **Advanced Text Analysis**: Utilizes a hybrid approach with regular expressions and the **spaCy** NLP library to accurately identify stock tickers and company names in unstructured text.
- **Automated Backtesting Engine**: Simulates a weekly trading strategy based on the scraped sentiment data.
- **Comprehensive Performance Metrics**: Calculates and compares key financial metrics, including:
    - Cumulative Returns (Growth of $100)
    - Compound Annual Growth Rate (CAGR)
    - Sharpe Ratio (Risk-Adjusted Return)
    - Max Drawdown
    - Win Rate vs. Benchmarks
- **Clear Visualizations**: Generates a plot to visually track the portfolio's performance over time against the S&P 500 (SPY) and Nasdaq-100 (QQQ).

---

## Methodology

### Part 1: Ticker Scraping (`sentiment_scraper.py`)

1.  **Initialization**: The script sets the target date range (2021-2023) and loads historical S&P 500 data from a local CSV file.
2.  **Weekly Iteration**: It loops through each week in the period. For each week, it identifies the valid S&P 500 tickers for that specific time frame.
3.  **Data Collection**: It scrapes the top and most controversial posts from a list of financial subreddits.
4.  **Ticker Extraction**: The text of each post is analyzed to find ticker symbols (e.g., `$GME`) and full company names (e.g., "GameStop").
5.  **Aggregation & Ranking**: The script counts the mentions for each valid ticker and ranks them to find the top 5 for the week.
6.  **Output**: The results are saved to a detailed CSV file, ready for the backtesting phase.

### Part 2: Strategy Backtesting (`strategy_backtester.py`)

1.  **Load Ticker Data**: The script ingests the weekly top 5 ticker data generated by the scraper.
2.  **Fetch Price Data**: Using the `yfinance` library, it downloads the historical open and close prices for the selected tickers and the benchmarks (SPY, QQQ).
3.  **Simulate Trades**: It calculates the weekly return based on the strategy rule: buy at the opening price on the first trading day of the week and sell at the closing price on the last trading day.
4.  **Performance Calculation**: It computes the portfolio's weekly returns and then calculates the full suite of performance metrics.
5.  **Generate Report**: The final analysis, including a summary table and a growth chart, is printed to the console and displayed.

---

## How to Run This Project

### Prerequisites

- Python 3.8 or newer
- A Reddit account with API credentials. [Click here to create a Reddit app](https://www.reddit.com/prefs/apps) and get your credentials.
- A CSV file containing historical weekly S&P 500 constituents. This file should have columns: `week_start`, `tickers`, and `names`.

### Installation

1.  **Clone the repository:**
    ```bash
    git clone [https://github.com/Zheng-Wang-TO/reddit_sentiment_based_stock_selection_strategy](https://github.com/Zheng-Wang-TO/reddit_sentiment_based_stock_selection_strategy.git)
    cd YourRepoName
    ```

2.  **Install the required Python libraries:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **(Recommended) Download the spaCy NLP model for better name recognition:**
    ```bash
    python -m spacy download en_core_web_sm
    ```

---

## Usage

This project follows a clear data pipeline. You must run the scripts in the following order.

### Step 1: Build the Historical S&P 500 Data

First, you need to generate the historical S&P 500 constituent data. The `build_sp500_history.py` script automates this by scraping Wikipedia.

1.  Open a terminal or command prompt.
2.  Run the script:
    ```bash
    python build_sp500_history.py
    ```
    This will create a file named `historical_sp500_by_week.csv`, which is required for the next step.

### Step 2: Run the Sentiment Scraper

With the historical data in place, you can now scrape Reddit for weekly ticker mentions.

1.  Open the `sentiment_scraper.py` script.
2.  Update your Reddit API credentials and ensure the `SP500_CSV_PATH` points to the `historical_sp500_by_week.csv` file you just created.
3.  Execute the script:
    ```bash
    python sentiment_scraper.py
    ```
    *Note: This process is data-intensive and may take several hours to complete.* It will generate files in the `reddit_weekly_data/` directory.

### Step 3: Run the Strategy Backtester

Finally, run the backtesting engine to analyze the results from the scraper.

1.  Open the `strategy_backtester.py` script.
2.  Update the `SELECTIONS_CSV_PATH` variable to point to the `detailed_weekly_top5_... .csv` file created in the previous step.
3.  Execute the script:
    ```bash
    python strategy_backtester.py
    ```
    This will output the final performance report and display the growth chart.

## Example Output

A sample performance report generated by the backtesting engine:


================================================== PERFORMANCE ANALYSIS RESULTS
             Portfolio    SPY    QQQ

CAGR                 14.85%  9.95% 11.75%
Sharpe Ratio           0.82   0.58   0.63
Max Drawdown        -23.10% -24.50% -31.20%
Weekly Volatility     2.45%  2.05%  2.75%
Win Rate vs SPY      57.90%    ---    ---
Win Rate vs QQQ      53.60%    ---    ---


![Example Growth Chart](https://i.imgur.com/your-chart-image.png)
*(This is a placeholder. You should run the analysis and upload your own chart image here.)*
